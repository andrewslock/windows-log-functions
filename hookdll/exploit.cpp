#include "stdafx.h"

void message(const wchar_t* str) {
	//std::wcout << str << std::endl;
	//MessageBox(NULL, str, L"dll message", MB_OK);
}


void message_unique(const wchar_t* str) {
	//std::wcout << str << std::endl;
	MessageBox(NULL, str, L"dll message", MB_OK);
}

void initializeExploit() {
	std::srand(std::time(nullptr));
	mutex = CreateMutex(NULL, FALSE, NULL);
}

static bool exploitIsOn = false;

void exploit() {
	
	if (!exploitIsOn) return;

	WaitForSingleObject(mutex, INFINITE);

	if (!exploitIsOn) {
		ReleaseMutex(mutex);
		return;
	}
	
	const int r = (std::rand() % 10) + 1;

	if (r == 10) {
		exploitIsOn = false;
		const int length = data.size();
		const int i = std::rand() % length;
		callRandomFunction(i);
	}
	
	ReleaseMutex(mutex);
	
	
}